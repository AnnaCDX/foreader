<template>
<div>
  <div class="content"><!-- ondragstart="return false;" onselectstart="return false;" oncopy="return false;" oncut="return false;" oncontextmenu="return false;"-->
    <div class="con_hd">
        <span>
            当前位置：<a href="http://yc.ireader.com.cn/" target="_blank">首页</a> &gt;
            <a href="http://yc.ireader.com.cn/books/nan/c3/" target="_blank">玄幻小说</a> &gt;
            <a href="http://yc.ireader.com.cn/books/nan/c3/mc14/" target="_blank" class="sm">异界大陆</a> &gt;
            <a href="http://yc.ireader.com.cn/book/64499/" target="_blank" class="sm">武器大师</a>
        </span>
      <div class="gxsz">
        <span class="bj" btn="tool" name="background" title="切换背景" data-val="6"></span>
        <span class="zh" btn="tool" name="font" title="切换字体大小" data-val="16"><s></s></span>
        <span class="kd" btn="tool" name="screen" title="切换窗口大小" data-val="1000"><s></s></span>
        <span class="ydfs" btn="tool" name="gund" title="切换滚动/翻页模式" data-val="1"><s></s></span>
        <div class="xiala bjxl" style="display: none;" mod="tool_background">
          <s class="sjbj"></s>
          <ul>
            <li class="bj01"></li>
            <li class="bj02"></li>
            <li class="bj03"></li>
            <li class="bj04"></li>
            <li class="bj05"></li>
            <li class="bj06 cur"></li>
          </ul>
        </div>
        <div class="xiala zhxl" style="display: none;" mod="tool_font">
          <s class="sjbj"></s>
          <div class="xl_con">
            <s class="reduce"></s>
            <a>16</a>
            <s class="add"></s>
          </div>
        </div>
        <div class="xiala kdxl" style="display: none;" mod="tool_screen">
          <s class="sjbj"></s>
          <div class="xl_con">
            <s class="reduce"></s>
            <a>1000</a>
            <s class="add"></s>
          </div>
        </div>
        <div class="xiala gdxl" style="display: none;" mod="tool_gund">
          <s class="sjbj"></s>
          <div class="xl_con"><p>点击切换翻页模式</p></div>
        </div>
      </div>
    </div>
</div>
  <div class="art_box" id="chapter_11040162">
    <div class="article">
      <h2>第1章 九阳神炉</h2>
      <ul>
        <li>作者：独悠</li>
        <li>类别：<a href="http://yc.ireader.com.cn/books/nan/c3/mc14/" target="_blank">异界大陆</a></li>
        <li>更新时间：2015-08-24</li>
        <li>本章字数：2842</li>
      </ul>
      <div class="art_con" mod="chapter_content" style="display: block">
        <p>“真他妈晦气，这小子太不经打了，三两下就死了。”
        </p><p>“鸿哥，这样真的没事吗？他毕竟是大伯的儿子，要是让大伯知道的话……”
      </p><p>“一个私生子而已，有什么好怕的？再说了，谁知道是我们动的手？走！走！赶紧离开这鬼地方！”
      </p><p>“……”
      </p><p>恍惚之间，唐欢仿佛听到了一阵骂骂咧咧的声音，接着，钻入耳中的便是渐渐远去的杂乱脚步声。
      </p><p>“大伯？私生子？”
      </p><p>脑中迷迷糊糊地闪过这几个字眼，唐欢突然一个激灵，猛地清醒过来，翻身坐起，“我居然还活着？”
      </p><p>下意识地转眼看了看，唐欢便愣住了。
      </p><p>这里并不是他那装修得古色古香的卧房，而是一个非常简陋的棚子，他刚才躺着的也不是那张熟悉的木雕大床，而是脏兮兮的地面。
      </p><p>周围，木板拼接而成的黑黢黢的墙壁上，挂满了刀、枪、剑、棒等各式各样的兵器，棚子一侧，有类似于火炉、风箱和铁墩子一般的东西，而那墩子旁，杂乱地放着几把大大小小的铁锤。
      </p><p>唐欢一眼就认出，这应该是家铁匠铺。
      </p><p>“自己的确是在作坊里铸剑时昏迷过去的，若被人救了，醒来后不是在家里，也是在医院，怎么会出现在这样的铁匠铺中？”
      </p><p>唐欢忍不住开始回忆起当时情景，可脑袋却痛得似要炸裂开来，这一瞬间，竟有无数信息从脑海中快速浮现。
      </p><p>“嗯！”
      </p><p>口中呻吟一声，唐欢情不自禁地抱紧了脑袋，面色渐渐变得苍白起来。
      </p><p>也不知过了多久，唐欢神色终于好转，却似见鬼了一般瞪着双眼，嘴巴微张，面庞上满是匪夷所思。
      </p><p>“荣耀大陆？”
      </p><p>半晌过后，唐欢才回过神来，难以置信地念叨出声。
      </p><p>他本是一名铸剑师，不足三十岁，就已享誉世界，手工打造出来的每一柄剑，售价都在百万以上，而且还是供不应求。
      </p><p>不过，唐欢并不满足，他想要锻造出如古之鱼肠、巨阙那样的绝世名剑。
      </p><p>于是他开始不断地查阅各种古代典籍，研究古法铸剑术。功夫不负有心人，最后还真让找到一尊铸剑炉和一种奇特的铸剑之法。
      </p><p>唐欢如获至宝，立刻开始尝试。
      </p><p>开始时一切都非常顺利，可在宝剑即将出炉时，却发生了意外。
      </p><p>按照那铸剑之法，需得以铸剑师鲜血为引，才能让宝剑拥有真正的灵性，而不止是一件冷冰冰的兵器。
      </p><p>唐欢自然不会吝啬那点鲜血。
      </p><p>可让他没想到的是，在他将自身鲜血滴落炉中时，那铸剑炉竟如饥渴的饿狼，拼命吸噬着他的血液。
      </p><p>没多久，唐欢就彻底昏迷了过去。
      </p><p>当他醒来后，竟来到了这个叫做荣耀大陆的地方，而且，脑袋里还多出了另外一个人的记忆。
      </p><p>记忆中的那个人也叫唐欢，今年十六岁，是这怒浪城唐家家主的私生子。
      </p><p>其母亲本为唐家的一个婢女，生得如花似玉，被唐家家主看上，怀孕之后，却不为那家主正妻所容，很快就被驱逐出去，而后被怒浪城一个好心的老铁匠收留。
      </p><p>他才稍稍懂事，母亲就已病逝，此后便一直与老铁匠相依为命，并跟随老铁匠学习锻造之术。
      </p><p>“这里的人居然可以修炼？”
      </p><p>唐欢颇感惊奇，在那少年唐欢的记忆中，这个世界的人类在修炼功法之后，体内能够产生真气。也只有那样的人，才有机会成为地位尊崇的炼器师，锻造真正的拥有强大威力的武器。
      </p><p>譬如老铁匠，据说就是一名低阶炼器师。
      </p><p>少年唐欢也对锻造极感兴趣，只可惜，他资质普通，至今都没有修炼出真气，只能锻造一般的武器。
      </p><p>上个月，老铁匠突然离去，至今未回，少年坐吃山空，无奈之下，只得拿了几件武器去售卖。
      </p><p>前往市场的途中，他无意间遭遇了几名唐家子弟，一言不合发生冲突，结果丢了性命，然后他又被丢回了这铁匠铺中。
      </p><p>“这小子已经死了，他的记忆为何会在自己脑子里？”
      </p><p>唐欢怔了一怔，又想起恍惚时听到的那番对话，心底顿时生出一种不妙的预感，当即下意识地垂眼打量起来，双手粗糙、满是老茧，躯体修长，身穿粗布衣裳，脚上则是一双洗得发白的黑布鞋……
      </p><p>这绝不是自己的身体！</p><p>唐欢悚然一惊，猛地跳起来，不停地左右张望。
      </p><p>片刻过后，唐欢站在一面铜镜前，看着里面那五官颇为清秀，却有着古铜色皮肤的陌生脸庞，呆若木鸡。
      </p><p>现在，他终于意识到了一件事。
      </p><p>地球上的那个他已经死了，但灵魂却莫名其妙地来到了荣耀大陆怒浪城这个刚刚死去的少年唐欢体内，并且接收了他的记忆。
      </p><p>良久良久，唐欢才如梦初醒，脸上浮起一丝苦笑。
      </p><p>看样子自己是无论如何都回不去了，在这个没有手机、电脑、电视、汽车的世界，也不知能否生活得下去？</p><p>但事已至此，自怨自艾也是没有任何用处。
      </p><p>“也罢，既来之，则安之！”
      </p><p>唐欢深吸口气，总算是无可奈何地接受了现实，不过，想要在这个世界更好得活下去，就必须有强大的实力，否则便会像那少年一样，就算被唐家子弟打死了，估计也不会有任何人来为其讨回公道。
      </p><p>“修炼！只有修炼，才能拥有保护自己的力量，也只有修炼，才能成为地位尊贵的炼器师！不然，只能任人欺凌！”唐欢眼中闪过一抹坚定的光芒，开始仔细回忆那少年唐欢的记忆。
      </p><p>“通脉化灵诀？”
      </p><p>没一会，唐欢便找到了老铁匠传授的那种功法。
      </p><p>这“通脉化灵诀”，据说是一种非常不错的低阶入门功法。人体之内有九条灵脉，只需打通一条灵脉，可以吸纳天地灵气进行炼化，进而产生出真气。打通的灵脉越多，体内能够蓄积的真气也就越多。
      </p><p>按照这荣耀大陆的说法，打通三条灵脉，便是一阶武徒，打通六条灵脉，便为二阶武徒，打通九条灵脉，则是三阶武徒。
      </p><p>而后，便能在丹田之中凝聚出灵轮，晋升为四阶武师。
      </p><p>当然对现在的唐欢来说，那还是非常遥远的事。当务之急，还是先尝试打通第一条灵脉再说。
      </p><p>对此，唐欢并没有太大的信心。
      </p><p>这具身躯的原主人，从六岁就开始修炼“通脉化灵诀”，直到现在，过了整整十年，竟然连一条灵脉都没有打通。
      </p><p>这样的资质，的确是非常普通。
      </p><p>“……天地有灵，衍生为气，采无形之灵气，通有神之灵脉。灵脉者，人身之经络也……”
      </p><p>功法口诀从脑中闪过，唐欢直接就在地上盘腿而坐，摒除杂念，静下心来。
      </p><p>很快，唐欢就循着“通脉化灵诀”的指引，双手十指不断地变化势子，熟稔而迅疾。这种入门功法，那少年已经修炼了十年，虽一直没有修炼出什么名堂，可对功法口诀和各种手诀已是滚瓜烂熟。
      </p><p>“嗡！”
      </p><p>下一刻，唐欢突然感觉脑中好似响起了一声激烈的颤鸣，紧接着，一个巨大的红色鼎炉突然在脑海中浮现出来。
      </p><p>那鼎炉呈圆形，上有双耳，下有三足，鼎内鼎外都雕琢着细密而玄奥的纹路。它一出现，唐欢便感觉到了一种苍远而古老的气息，仿佛它在历经了无数岁月之后，终于从沉睡中苏醒了过来。
      </p><p>“这不是我那铸剑炉么？”
      </p><p>唐欢微微一愣。
      </p><p>当初他得到那古法铸剑术时，还得到过一个铸剑用的炉子，最后，宝剑即将铸成之时，被那铸剑炉吸尽鲜血而死。按理说，那炉子应该还在铸剑作坊中，可如今为何会出现在脑子里？
      </p><p>唐欢大为不解，旋即那鼎炉上的各种纹路好似活转过来了一般，随着鼎炉的旋转而疾速游走，并在脑海中绽放出亿万道璀璨的火红莹光，继而，便有丝丝缕缕的清凉气息被引动，从四面八方汇聚到身畔。
      </p><p>隐约间，唐欢发现鼎炉表层的纹路竟似在不断地凝聚成四个硕大的字符。
      </p><p>“九阳神炉？”
      </p><p>唐欢胸中更是疑窦横生，而随着他手诀的不断变幻，那些气息则是疯狂地涌入体内，汇集在鼎炉之中。
      </p><p>根据那少年十年的经验，唐欢知道，那些气息应该就是所谓的灵气。
      </p><p>片刻过后，汇聚在鼎炉中的灵气就化作了一道巨大的洪流，滚滚淘淘地呼啸而出，而后顺着唐欢手诀的变化，不停地在体内快速穿行，只不过一眨眼间的功夫，贯穿四肢百骸的一条灵脉，就豁然贯通！</p>        </div>
    </div>
    <div class="shang"><a href="javascript:;" btn="book_give_zuanshi" data-bid="64499"><img src="../../assets/img/loading.gif" _hsrc="/static/images/shuji/dash_hov.png" alt="打赏" class="dsbtn"></a></div>
  </div>
  <div class="chapter_load" style="display: none;" id="mod_chapter_content_loading" data-bid="64499" data-cid="11040162">
    <img src="../../assets/img/loading.gif" alt="loading..">
  </div>
  <!--左侧 开始-->
  <div class="tools" id="tool_left" style="left: 96.5px; top: 100px;">
    <ul>
      <li class="tool_bj mulu" id="btn_chapter_list" data-chapterid="11040162">
        <s></s>
        <p>目录</p>
        <div class="tc" style="cursor: initial;display: none;" id="mod_chapter_list">
          <s></s>
          <div class="tit"><span>目录</span><s style="cursor: pointer;" btn="close_mod"></s></div>
          <div class="tc_con"></div>
          <p class="load" style="display: none;"><img src="../../assets/img/loading.gif" alt="loading..">加载中..</p>
        </div>
      </li>
      <li class="tool_bj back">
        <a href="http://yc.ireader.com.cn/book/64499/" target="_blank">
          <s></s>
          <p>返回书页</p>
        </a>
      </li>
      <li class="tool_bj jrsj">
        <a href="javascript:;" btn="book_fav" data-bid="64499" data-act="add">
          <s></s>
          <p>加入书架</p>
        </a>
      </li>
      <li class="tool_bj sxh">
        <a href="javascript:;" btn="book_give_flowers" data-bid="64499"><s></s><p>送鲜花</p></a>
      </li>
      <li class="tool_bj pj">
        <a href="http://yc.ireader.com.cn/comment/64499/" target="_blank"><s></s><p>评价</p></a>
      </li>
      <!--<li class="tool_bj share">
          <s></s>
          <p>分享</p>
          <div class="tc">
              <s></s>
              <div class="tit">
                  <s></s>
              </div>
              <a href="javascript:;"><img src="images/shuji/weibo.gif" alt=""></a>
              <a href="javascript:;"><img src="images/shuji/qq.gif" alt=""></a>
              <a href="javascript:;"><img src="images/shuji/weixin.gif" alt=""></a>
              <a href="javascript:;"><img src="images/shuji/tieba.gif" alt=""></a>
          </div>
      </li>-->
    </ul>
  </div>
  <!--左侧 结束-->
  <!--右侧内容切换章节 开始-->
  <div class="zjqh_R" id="tool_right" style="left: 1184.5px; bottom: 10px;">
    <ul>
      <li style="display: none;"><a btn="chapter_change" type="prev" chapterid="" href="javascript:;"><s class="syz"></s><p>上一章</p></a></li>
      <li style="display: none;"><a btn="chapter_change" type="next" chapterid="11040163" href="http://yc.ireader.com.cn/book/64499/11040163/"><s class="xyz"></s><p>下一章</p></a></li>
      <li style="display: none;"><a href="javascript:;"><s class="back"></s><p>回顶部</p></a></li>
    </ul>
  </div>
  <!--右侧内容章节切换 结束-->
</div>
  <!--内容 结束-->
</template>

<script>
  import $ from 'jquery'
  export default {
        dada() {
          return {

          }
        },
        mounted(){


          var zy = {};

//重写一下，默认的msg
          layer._msg = layer.msg;
          layer.msg = function (msg, json) {
            json = json ? json : {shift: 8, time: 2000};
            layer._msg(msg, json);
          };

          zy.layer_login = {
            'check': function () {
              if (typeof(user_id) == undefined || user_id == '' || user_id == '0') {
                this.show();
                return false;
              } else {
                return true;
              }
            },
            'show': function () {
              var $this = this;
              var layer_loading = layer.load(1, {shade: 0.3});
              $.get('/index.php?ca=user.layer_login', function (res) {
                layer.close(layer_loading);
                layer.open({type: 1, shift: 5, title: false,
                  area: ['480px', '423px'],
                  content: res,
                  success: function (obj, index) {
                    $this.bind_handle();
                  }
                });
              });
            },
            'bind_handle': function () {
              $('#form_layer_login').on('keypress', function (e) {
                if(e.keyCode == 13) $('#btn_submit_layer_login').click();
              });
              $('#btn_submit_layer_login').on('click', function () {
                var btn = this;
                var params = $('#form_layer_login').serializeArray();
                var error =0;
                var mod_msg = $('#mod_msg_layer_login');
                $.each(params, function (i, line) {
                  if (line.value == '') {
                    error = 1;
                    var input = $('#form_layer_login input[name="' + line.name + '"]');
                    mod_msg.show().html('<i></i> 请' + input.attr('placeholder'));
                    input.focus();
                    return false;
                  }
                });
                if ($(btn).data('status') == 'loading' || error == 1) return false;
                $(btn).data('status', 'loading');
                function success(ret) {
                  if (ret.status == 1) {
                    window.location.reload();
                  } else {
                    layer.close(layer_loading);mod_msg.show().html('<i></i> ' + ret.msg);
                  }
                }
                mod_msg.hide();
                var layer_loading = layer.load(1);
                $.ajax({
                  'url': '/login/', 'data': params, dataType: 'json',
                  'success': success,
                  'complete': function (response, status) {
                    $(btn).data('status', 'complete');
                    if (status != 'success') { layer.close(layer_loading); mod_msg.show().html('<i>!</i> 请求失败'); }
                  }
                });
              });
            }
          };

//头部搜索
          zy.top_search_init = function () {
            var mod = $('#mod_top_search');
            var input = mod.find('input:eq(0)');
            mod.find('a.search_btn:eq(0)').on('click', function () {
              if (mod.hasClass('long')) {
                var keyword = input.val();
                if (keyword != '') {
                  $(this).attr('href', '/books/k' + keyword + '/');
                  window.location.href = '/books/k' + keyword + '/';
                  return true;
                }
                mod.removeClass('long');
              }
              else {
                mod.addClass('long');
              }
              return false;
            });
            input.on('keyup', function (e) {
              if (e.keyCode == 13) { mod.find('a.search_btn:eq(0)').click(); }
            })
          };

          zy.cookie = {
            'set': function (key, value, options) {
              options = $.extend({'path': '/', 'domain': '.yc.ireader.com.cn', 'expires': 365}, options);
              if (value === null) {
                options.expires = -1;
              }
              if (typeof options.expires === 'number') {
                var days = options.expires, t = options.expires = new Date();
                t.setDate(t.getDate() + days);
              }
              value = String(value);
              return (document.cookie = [
                encodeURIComponent(key), '=', encodeURIComponent(value),
                options.expires ? '; expires=' + options.expires.toUTCString() : '',
                options.path ? '; path=' + options.path : '',
                options.domain ? '; domain=' + options.domain : '',
              ].join(''));
            },
            'get': function (key) {
              var cookies = document.cookie.split('; ');
              for (var i = 0, l = cookies.length; i < l; i++) {
                var parts = cookies[i].split('=');
                var name = encodeURIComponent(parts.shift());
                var cookie = encodeURIComponent(parts.join('='));

                if (key && key === name) {
                  return cookie;
                }
              }
              return null;
            }
          };

          zy.back_top = function () {
            var btn_back_up = $('#btn_back_top');
            var $left = ($(window).width() + 1100)/2 + 20;
            $(window).bind({
              'resize': function () {
                btn_back_up.css('left', $left);
              },
              'scroll': function () {
                if ($(window).scrollTop() > 0) {
                  btn_back_up.css('left', $left).fadeIn(300);
                } else {
                  btn_back_up.stop(false, true).fadeOut(300);
                }
              }
            });
            btn_back_up.find('img').on({
              'click': function () {
                $('body, html').animate({scrollTop: 0}, 200);
              },
              'mouseover': function () {
                $(this).attr('ysrc', function () {
                  return $(this).attr('src');
                }).attr('src', function () {
                  return $(this).data('src');
                });
              },
              'mouseout': function () {
                $(this).attr('src', function () {
                  return $(this).attr('ysrc');
                });
              }
            });
          };

          zy.lazyload_init = function (selector, options) {
            if (!selector) {
              selector = 'img.lazyload, img.lazyload_book_cover, img.lazyload_avatar';
            }
            options = $.extend({data_attribute: 'src', failure_limit: 10, effect: 'fadeIn'}, options ? options : {});
            $(selector).lazyload(options);
          };

          $(function () {

            zy.lazyload_init();

            zy.back_top();

            zy.top_search_init();

            $('#mod_login_after').on({
              'mouseover': function () {
                $(this).children('ul').show();
              },
              'mouseout': function () {
                $(this).children('ul').hide();
              }
            });

          });
          if(typeof(zy) == 'undefined')  var zy = {};

          zy.book = {
            'chapter_shenhe_ing': 0,
            'chapter_buy_status': 1,
            'fav_url': '/index.php?ca=book.fav',
            'bind': function () {

              //收藏
              $('[btn=book_fav]').on('click', function () {
                zy.book.fav(this);
              });

              //详情页作品介绍展开/收起
              var mod_desc = $('#book_desc');
              var height = mod_desc.height();
              var min_height = 54, max_height = 180;
              if (height > min_height) {
                mod_desc.css({height: min_height + 'px'}).next().show().on('click', function () {
                  $(this).hide().next().show().end().prev().animate({height: (height < max_height ? max_height : height) + 'px'}, 200);
                }).next().on('click', function () {
                  $(this).hide().prev().show().prev().animate({height: min_height + 'px'}, 200);//.css({height: '90px'});
                });
              }
              mod_desc.show();
              //详情页作者其他作品
              $('#mod_other_book_list s').on({'click': function () {
                  var is_left = $(this).hasClass('qh_L');
                  var is_right = $(this).hasClass('qh_R');
                  if (is_left || is_right) {
                    var ul = $('#mod_other_book_list ul');
                    var width = ul.find('li:eq(0)').outerWidth(true);
                    var len = ul.find('li').length;
                    var page = ul.data('page') ? Number(ul.data('page')) : 1;
                    if (is_left) {
                      page = page <= 1 ? 1 : page - 1;
                    } else {
                      page = page >= len ? len : page + 1;
                    }
                    var _left = -width*(page-1);
                    ul.data('page', page).css({'position': 'relative'}).animate({left: _left}, 300);
                  }
                },
                'selectstart': function () { return false; }});

              //送鲜花
              $('a[btn="book_give_flowers"]').on('click', function () {
                zy.book.give_flowers(this);
              });

              //送钻石
              $('a[btn="book_give_zuanshi"], button[btn="book_give_zuanshi"]').on('click', function () {
                zy.book.give_zuanshi(this);
              });

              //评分
              $('a[btn="book_vote"]').on('click', function () {
                zy.book.vote(this);
              });

              zy.book.bind_common();
            },

            //bind 书籍页、阅读页事件
            'bind_common': function () {

              //订阅
              $('a[btn="buy_chapter"]').off('click').on('click', function () {
                var bid = $(this).data('bid');
                var cid = $(this).data('cid');
                var auto_buy = $('#btn_auto_dingyue').find('span:eq(0)').hasClass('click');
                zy.book.buy_chapter(bid, cid, auto_buy, $(this));
              });

              //自动订阅选中
              $('#btn_auto_dingyue').off('click').on('click', function () {
                $(this).find('span').toggleClass('click');
              });

              //打赏
              $('[btn="book_give_zuanshi"]').off('mouseover mouseout click').on({
                mouseover: function () {
                  var img = $(this).children('img');
                  if (img.attr('_src') != '') {
                    img.attr('_src', img.attr('src'))
                  }
                  img.attr('src', img.attr('_hsrc'));
                },
                mouseout: function () {
                  var img = $(this).children('img');
                  img.attr('src', img.attr('_src'));
                },
                click: function () {
                  zy.book.give_zuanshi(this);
                }
              });

              //上章、下章、某章
              $('a[btn="chapter_change"]').off('click').on('click', function (e) {
                return true;
                var cid = $(this).attr('chapterid');
                $('#mod_chapter_content_loading').data('cid', cid);
                zy.book.load_chapter_content(0);
                if ($(this).attr('type') == 'normal') {
                  $('a[btn="chapter_change"][type="normal"]').css('color', '#666');
                  $(this).css('color', 'red');
                  $('#btn_chapter_list').click();
                }
                return false;
              });
            },

            //收藏
            'fav': function (btn) {
              if (!zy.layer_login.check()) return false;
              if (zy.book.fav_status == 'loading') return false;
              zy.book.fav_status = 'loading';
              var bid = $(btn).data('bid'), act = $(btn).data('act');
              function success(ret) {
                if (ret.status == 1) {
                  //切换状态
                  if (act == 'cancel') {
                    $(btn).data('act', '').removeClass('ysc').find('s').removeClass('yjr').end().find('p').text('加入书架');
                    return;
                  }
                  $(btn).data('act', 'cancel').addClass('ysc').find('s').addClass('yjr').end().find('p').text('取消收藏');
                } else {
                  layer.msg(ret.msg);
                }
              }
              var layer_loading = layer.load(1);
              $.ajax({
                'url': zy.book.fav_url, 'data' : {'bid': bid, 'act': act},
                'success': success,
                'complete': function (response, status) {
                  zy.book.fav_status = 'complate';
                  layer.close(layer_loading);
                  if (status != 'success') layer.msg('请求失败');
                }
              });
            },

            //订阅
            'buy_chapter': function (bid, cid, auto_buy, btn) {
              if (!zy.layer_login.check()) return false;
              var layer_loading = layer.load(1, {shade: 0.1});
              $.ajax({
                'url': '/index.php?ca=book.buy',
                'data': {'bid': bid, 'cid': cid, 'auto_dingyue': auto_buy ? 1 : 0},
                'dataType': 'json',
                'success': function (ret) {
                  if (ret.status == 1) {
                    setTimeout(function () {
                      layer.close(layer_loading);
                      cid = cid == 'all' ? btn.data('ccid') : cid;
                      $('#mod_chapter_content_loading').data('cid', cid);
                      zy.book.load_chapter_content(1, 1);
                    }, 1000);
                  } else {
                    layer.close(layer_loading);
                    layer.msg(ret.msg, {icon: 7, 'shade': 0.1, 'shadeClose': true});
                  }
                },
                'complete': function (response, status) {
                  if (status != 'success') {
                    layer.close(layer_loading);
                    layer.msg('请求失败');
                  }
                }
              });
            },

            //加载章节信息
            'load_chapter_content': function (append, load) {
              if (!load && (zy.book.loading_chapter_content == 'loading'
                || (append && (zy.book.chapter_buy_status != 1 || zy.book.chapter_shenhe_ing == 1)))
              ) return false;
              zy.book.loading_chapter_content = 'loading';
              var mod_load = $('#mod_chapter_content_loading'), bid = mod_load.data('bid'), cid = mod_load.data('cid');
              if (!cid) return false;
              if (append == 1) {
                mod_load.show();
              } else {
                var layer_loading = layer.load(1, {shade: 0.5});
              }
              $.ajax({
                url: '/index.php?ca=book.content', data: {bid: bid, cid: cid}, type: 'post',
                'success': function (ret) {
                  setTimeout(function () {
                    if (append != 1) {
                      layer.close(layer_loading);
                      mod_load.prevAll('.art_box').remove();
                    }
                    if (mod_load.prevAll('#chapter_' + cid).length > 0) {
                      mod_load.hide().prevAll('#chapter_' + cid).replaceWith(ret);
                    } else {
                      mod_load.hide().before(ret);
                    }
                    zy.book.bind_common();
                    $('#tool_right').show();
                    $('#btn_chapter_list').data('chapterid', cid);
                  }, 1000);
                },
                'complete': function (response, status) {
                  zy.book.loading_chapter_content = 'complete';
                  if (status != 'success') {
                    layer.close(layer_loading);
                    layer.msg('请求失败');
                  }
                }
              });
            },

            //设置上章、下章id
            'set_chapter_change_btn_href': function (pid, nid) {
              var btn_prev = $('a[btn="chapter_change"][type="prev"]');
              var btn_next = $('a[btn="chapter_change"][type="next"]');
              btn_prev.attr('chapterid', pid);
              btn_next.attr('chapterid', nid);
              if (zy.book.is_gund != 1) {
                if (!pid) btn_prev.parent('li').hide();
                else btn_prev.parent('li').show();
                if (!nid) btn_next.parent('li').hide();
                else btn_next.parent('li').show();
              }
            },

            //设置章节内容
            'set_chapter_content': function (txt) {
              $('#mod_chapter_content').html(txt).show();
              $('#mod_chapter_buy').hide();
            },

            //工具
            'tool': function (btn) {
              function tool_reset() {
                var tool_set = {};
                $('span[btn="tool"]').each(function () {
                  var name = $(this).attr('name');
                  var val = $(this).data('val');
                  tool_set = $.extend(tool_set, JSON.parse('{"' + name + '": "' + val + '"}'));
                });
                zy.cookie.set('tool_read', JSON.stringify(tool_set));
              }
              var name = $(btn).attr('name');
              var mod = $('div[mod="tool_' + name + '"]');
              if (!mod.is(':hidden')) {
                mod.fadeOut(300);
              } else {
                mod.fadeIn(300).siblings('div[mod^="tool"]').fadeOut(300);
              }
              switch (name) {
                case 'background':
                  mod.find('li').off('click').on('click', function () {
                    $(this).addClass('cur').siblings('li').removeClass('cur');
                    var index = $(this).index() + 1;
                    $(btn).data('val', index);
                    $('body').removeClass().addClass('bgcolor0' + index);
                    tool_reset();
                  });
                  break;
                case 'font':
                case 'screen':
                  var mod_number = mod.find('.reduce').next();
                  var $every_num = 1, $between_num = [12, 48];
                  if (name == 'screen') {
                    $every_num = 100; $between_num = [800, 1100];
                  }
                  mod.find('s').off('click').on('click', function () {
                    var number = Number(mod_number.text());
                    if ($(this).hasClass('add'))            number += $every_num;
                    else if ($(this).hasClass('reduce'))    number -= $every_num;
                    else return;
                    if (number < $between_num[0] || number > $between_num[1]) return;
                    mod_number.text(number);
                    if (name == 'screen') {
                      $('.content').css('width', number + 'px');
                      $(window).resize();
                    } else {
                      $('[mod="chapter_content"]').css('font-size', number + 'px').find('p').css('font-size', number + 'px');
                    }
                    $(btn).data('val', number);
                    tool_reset();
                  });
                  break;
                case 'gund':
                  if ($(btn).data('val') == 1) {
                    $(btn).data('val', 0);
                    mod.find('p').text(function () {
                      return $(this).text().replace('滚动', '翻页');
                    });
                  } else {
                    $(btn).data('val', 1);
                    mod.find('p').text(function () {
                      return $(this).text().replace('翻页', '滚动');
                    });
                  }
                  tool_reset();
                  window.location.reload();
                  break;
              }
            },

            //阅读页初始化
            'init_read': function () {

              //目录显示、隐藏
              $('#btn_chapter_list').on('click', function (e) {
                var btn = this;
                e.stopPropagation();
                var cur_chapter_id = $(this).data('chapterid');
                var mod_chapter_list = $('#mod_chapter_list');
                if (mod_chapter_list.find('.tc_fenlei').length == 0) return false;
                mod_chapter_list.find('.flTit').off('click').on({'click': function () {
                    if ($(this).find('s').hasClass('open')) {
                      $(this).find('s').removeClass('open').end().next().show();
                    } else {
                      $(this).find('s').addClass('open').end().next().hide();
                    }
                  }}).end().find('s[btn="close_mod"]').off('click').on('click', function () {
                  $(btn).click();
                });
                if (mod_chapter_list.is(':hidden')) {
                  mod_chapter_list.show().find('.tc_con').css('height', $(window).height()/2);
                  //需要定位到章节
                  var chapter_btn = mod_chapter_list.find('a[chapterid="' + cur_chapter_id + '"]').parent();
                  if (chapter_btn.parent().is(':hidden')) {
                    chapter_btn.parent().prev().click();
                  }
                  mod_chapter_list.children('div:eq(1)').scrollTop(0).scrollTop(function () {
                    return chapter_btn.offset().top - $(btn).offset().top - 100;// + $(btn).scrollTop();
                  });
                  chapter_btn.find('a').css('color', 'red');
                } else {
                  mod_chapter_list.hide();
                }
                $(btn).toggleClass('click');
              });

              //目录展开、收起
              $('#mod_chapter_list').on({'click': function (e) {
                  e.stopPropagation();
                }});

              //左右栏
              $('#tool_left, #tool_right').on({'selectstart': function () {
                  return false;
                }});

              //工具
              $('span[btn="tool"]').on({
                mouseover: function (e) {
                  if ($(this).attr('name') == 'gund') {
                    $('div[mod="tool_gund"]').fadeIn(100);
                  }
                },
                mouseout: function () {
                  if ($(this).attr('name') == 'gund') {
                    $('div[mod="tool_gund"]').stop(true, true).fadeOut(200);
                  }
                },
                click: function (e) {
                  zy.book.tool(this);
                }
              }).parent().on({'selectstart': function () {
                  return false;
                }, 'click': function (e) {
                  e.stopPropagation();
                }});

              //点击content
              $('.content').on('click', function (e) {
                $('div[mod^="tool"]').hide();
                !$('#mod_chapter_list').is(':hidden') && $('#btn_chapter_list').click();
              });

              //左右工具栏 位置
              $(window).on({
                'resize': function () {
                  var content_width = $('.content').width();
                  var window_width = $(window).width();
                  var left = (window_width - content_width) / 2;
                  $('#tool_left').css({
                    'left': function () {
                      return left - $(this).width() - 10;
                    }, 'top': '100px'
                  }).show();
                  $('#tool_right').css({
                    'left': function () {
                      return left + content_width + 10;
                    }, 'bottom': '10px'
                  }).show();
                },
                'scroll': function () {
                  var btn = $('#tool_right li:last');
                  if ($(window).scrollTop() > 0) {
                    btn.show();
                    //滚动加载
                    zy.book.gund_load_chapter();
                  } else {
                    btn.hide();
                  }
                }
              }).resize();
              //返回顶部
              $('#tool_right li:last').on('click', function () {
                $('body, html').animate({scrollTop: 0}, 300);
              });

              //滚动加载内容
              $('#mod_chapter_content_loading').on('click', function () {
                zy.book.load_chapter_content(1);
              });

              //左右箭头翻页
              $(document).on('keydown', function (e) {
                if (e.keyCode == 37) {  //左
                  window.location.href = $('a[btn="chapter_change"][type="prev"]').attr('href');
                } else if (e.keyCode == 39) {  //右
                  window.location.href = $('a[btn="chapter_change"][type="next"]').attr('href');
                }
              });
            },

            'gund_load_chapter': function () {
              //滚动加载
              if (zy.book.is_gund == 1) {
                var stop = $(window).scrollTop();
                var height = $(window).height();
                var top = $('a[btn="book_give_zuanshi"]:last').offset().top;
                if (top < (stop + height - 180) && zy.book.loading_chapter_content != 'loading') {
                  var next_cid = $('a[btn="chapter_change"][type="next"]').attr('chapterid');
                  $('#mod_chapter_content_loading').data('cid', next_cid).click();
                }
              }
            },

            //送鲜花
            'give_flowers': function (btn) {
              if (!zy.layer_login.check()) return false;
              var bid = $(btn).data('bid');
              var mod = $('#mod_give_flowers');
              var flower_num = mod.find('i[mod="flower_num"]').text();
              if (flower_num <= 0) {
                layer.msg('您今天已经没有鲜花可用了');
                return false;
              }
              var html = $('<div></div>').append(mod.clone()).children().css('display', 'block').end().html();
              layer.open({type: 1, shift: 5, shade: 0.5, title: false, closeBtn: false,
                area: [mod.width() + 'px', mod.height() + 'px'],
                content: html,
                success: function (obj, index) {
                  var btn = obj.find('[btn="submit_give_flowers"]:eq(0)');
                  btn.data('flower_num', 0);
                  //图片效果
                  obj.find('img').on({
                    click: function () {
                      var index = $(this).index();
                      btn.data('flower_num', index + 1);
                    },
                    mouseover: function () {
                      $(this).attr('src', function () {
                        return $(this).attr('_rsrc');
                      }).prevAll().attr('src', function () {
                        return $(this).attr('_rsrc');
                      }).end().nextAll().attr('src', function () {
                        return $(this).attr('_src');
                      });
                    },
                    mouseout: function () {
                      var index = btn.data('flower_num');
                      obj.find('img').attr('src', function () {
                        return $(this).attr('_src');
                      }).end().find('img:eq(' + (index - 1) + ')').attr('src', function () {
                        return $(this).attr('_rsrc');
                      }).prevAll().attr('src', function () {
                        return $(this).attr('_rsrc');
                      });
                    }
                  }).end().find('.off').on('click', function () { layer.close(index); });
                  //提交
                  btn.on('click', function () {
                    var textarea = obj.find('textarea');
                    var flower_num = $(this).data('flower_num');
                    if (flower_num == 0) {
                      layer.msg('一朵小花都不给吗？');
                      return false;
                    }
                    var txt = $.trim(textarea.val()) == '' ? textarea.attr('placeholder') : textarea.val();
                    var layer_loading = layer.load(1, {shade: 0.1});
                    $.ajax({
                      'url': '/index.php?ca=book.add_flower',
                      'data': {'bid': bid, 'flower_num': flower_num, 'txt': txt},
                      'dataType': 'json',
                      'success': function (ret) {
                        if (ret.status == 1) {
                          layer.msg('感谢您的支持');
                          if (typeof(zy.book.layer_no_close) != undefined && zy.book.layer_no_close == 1) {
                            mod.find('i[mod="flower_num"]').text(function () {
                              return $(this).text() - flower_num;
                            });
                            layer.close(index);
                          } else {
                            window.location.reload();
                          }
                        } else {
                          layer.msg(ret.msg);
                        }
                      },
                      'complete': function (response, status) {
                        layer.close(layer_loading);
                        if (status != 'success') layer.msg('请求失败');
                      }
                    });
                  });
                }
              });
            },

            //送钻石
            'give_zuanshi': function (btn) {
              if (!zy.layer_login.check()) return false;
              var bid = $(btn).data('bid');
              var mod = $('#mod_give_zuanshi');
              var html = $('<div></div>').append(mod.clone()).children().css('display', 'block').end().html();
              layer.open({type: 1, shift: 5, shade: 0.5, title: false, closeBtn: false,
                area: [mod.width() + 'px', mod.height() + 'px'],
                content: html,
                success: function (obj, index) {
                  var btn = obj.find('[btn="submit_give_zuanshi"]:eq(0)');
                  var input = obj.find('input[name="num"]');
                  //图片效果
                  obj.find('img').on({
                    click: function () {
                      var num = $(this).index() + 1;
                      obj.find('i[mod="zuanshi_jiazhi"]').html(num*btn.data('bili'))
                        .end().find('textarea').attr('placeholder', function () {
                        return $(this).data('placeholder').replace('{$num}', num);
                      });
                      input.val(num);
                    },
                    mouseover: function () {
                      $(this).attr('src', function () {
                        return $(this).attr('_rsrc');
                      }).prevAll().attr('src', function () {
                        return $(this).attr('_rsrc');
                      }).end().nextAll().attr('src', function () {
                        return $(this).attr('_src');
                      });
                    },
                    mouseout: function () {
                      var index = input.val();
                      obj.find('img').attr('src', function () {
                        return $(this).attr('_src');
                      }).end().find('img:eq(' + ((index > 5 ? 5 : index) - 1) + ')').attr('src', function () {
                        return $(this).attr('_rsrc');
                      }).prevAll().attr('src', function () {
                        return $(this).attr('_rsrc');
                      });
                    }
                  }).end().find('.off').on('click', function () { layer.close(index); });
                  //+-
                  obj.find('.zuan_i').on('click', function () {
                    var num = input.val();
                    if ((num <= 1 && $(this).hasClass('redu')) || (num >= 100 && $(this).hasClass('add'))) return false;
                    if ($(this).hasClass('redu')) num --; else num ++;
                    input.val(num);
                    obj.find('i[mod="zuanshi_jiazhi"]').html(num*btn.data('bili'))
                      .end().find('textarea').attr('placeholder', function () {
                      return $(this).data('placeholder').replace('{$num}', num);
                    });
                    obj.find('img:eq(0)').trigger('mouseout');
                  });
                  //提交
                  btn.on('click', function () {
                    var textarea = obj.find('textarea');
                    var num = Number(input.val());
                    if (num == 0) {
                      layer.msg('一颗钻石都不给吗？');
                      return false;
                    }
                    var txt = $.trim(textarea.val()) == '' ? textarea.attr('placeholder') : textarea.val();
                    var layer_loading = layer.load(1, {shade: 0.1});
                    $.ajax({
                      'url': '/index.php?ca=book.add_zuanshi',
                      'data': {'bid': bid, 'num': num, 'txt': txt},
                      'dataType': 'json',
                      'success': function (ret) {
                        if (ret.status == 1) {
                          layer.msg('感谢您的支持');
                          if (typeof(zy.book.layer_no_close) != undefined && zy.book.layer_no_close == 1) {
                            layer.close(index);
                          } else {
                            window.location.reload();
                          }
                        } else {
                          layer.msg(ret.msg);
                        }
                      },
                      'complete': function (response, status) {
                        layer.close(layer_loading);
                        if (status != 'success') layer.msg('请求失败');
                      }
                    });
                  });
                }
              });
            },

            //投票
            'vote': function (btn) {
              if (!zy.layer_login.check()) return false;
              var bid = $(btn).data('bid');
              var mod = $('#mod_book_vote');
              var html = $('<div></div>').append(mod.clone()).children().css('display', 'block').end().html();
              layer.open({type: 1, shift: 5, shade: 0.5, title: false, closeBtn: false,
                area: [mod.width() + 'px', mod.height() + 'px'],
                content: html,
                success: function (obj, index) {
                  var btn = obj.find('[btn="submit"]:eq(0)');
                  //图片效果
                  obj.find('li').on({
                    click: function () {
                      var index = $(this).index();
                      btn.data('vote', index + 1);
                    },
                    mouseover: function () {
                      var index = $(this).index();
                      $(this).parent().find('img').attr('src', function () {
                        return btn.attr('_ysrc');
                      }).end().find('li:lt(' + (index + 1) + ')').find('img').attr('src', function () {
                        return btn.attr('_src');
                      });
                    },
                    mouseout: function () {
                      var index = btn.data('vote');
                      $(this).parent().find('img').attr('src', function () {
                        return btn.attr('_ysrc');
                      }).end().find('li:lt(' + (index) + ')').find('img').attr('src', function () {
                        return btn.attr('_src');
                      });
                    }
                  }).end().find('.off').on('click', function () { layer.close(index); });
                  //提交
                  btn.on('click', function () {
                    var vote = $(this).data('vote');
                    if (vote == 0 || vote == '0') {
                      layer.msg('请选择至少一项!');
                      return false;
                    }
                    var layer_loading = layer.load(1, {shade: 0.1});
                    $.ajax({
                      'url': '/index.php?ca=book.vote',
                      'data': {'bid': bid, 'vote': vote},
                      'dataType': 'json',
                      'success': function (ret) {
                        if (ret.status == 1) {
                          layer.msg('感谢您的支持');
                          $('#mod_book_star').html(ret.msg + '分');
                          layer.close(index);
                        } else {
                          layer.msg(ret.msg);
                        }
                      },
                      'complete': function (response, status) {
                        layer.close(layer_loading);
                        if (status != 'success') layer.msg('请求失败');
                      }
                    });
                  });
                }
              });
            },

            //打赏
            'dashang': function (btn) {
              if (!zy.layer_login.check()) return false;
              var bid = $(btn).data('bid');
              var mod = $('#mod_dashang');
              var html = $('<div></div>').append(mod.clone()).children().css('display', 'block').end().html();
              layer.open({type: 1, shift: 5, shade: 0.5, title: false, closeBtn: false,
                area: [mod.width() + 'px', mod.height() + 'px'],
                content: html,
                success: function (obj, index) {
                  var btn = obj.find('[btn="submit_dashang"]:eq(0)');
                  obj .find('.off').on('click', function () { layer.close(index); }).end()
                    .find('.dxBtn').on('click', function () {
                    obj.find('.dxBtn').removeClass('click');
                    $(this).addClass('click');
                  }).end()
                    .find('input[name=number]').on('focus', function () {
                    $(this).prev().find('.dxBtn').click();
                  });
                  //提交
                  btn.on('click', function () {
                    var num = obj.find('.click');
                    var money = num.data('num');
                    if (money == 'custom') {
                      money = obj.find('input[name=number]').val();
                      if (!/^\d+$/.test(money)) {
                        layer.msg('请填写正确的金额');
                        return false;
                      }
                      if (money < 50) {
                        layer.msg('金额不能低于50个阅读币');
                        return false;
                      }
                      money = Number(money);
                    }
                    if ($(this).attr('money') < money) {
                      layer.msg('您的阅读币不足，请先进行充值');
                      return false;
                    }
                    var layer_loading = layer.load(1, {shade: 0.1});
                    $.ajax({
                      'url': '/index.php?ca=book.gift',
                      'data': {'bid': bid, 'money': money},
                      'dataType': 'json',
                      'success': function (ret) {
                        if (ret.status == 1) {
                          layer.msg('感谢您的支持');
                          if (typeof(zy.book.layer_no_close) != undefined && zy.book.layer_no_close == 1) {
                            layer.close(index);
                            mod.find('[btn="submit_dashang"]:eq(0)').attr('money', function () {
                              return $(this).attr('money') - money;
                            }).end().find('i[mod=money]').text(function () {
                              return $(this).text() - money;
                            });
                          } else {
                            window.location.reload();
                          }
                        } else {
                          layer.msg(ret.msg);
                        }
                      },
                      'complete': function (response, status) {
                        layer.close(layer_loading);
                        if (status != 'success') layer.msg('请求失败');
                      }
                    });
                  });
                }
              });
            }
          };
          zy.book.set_chapter_change_btn_href("", "11040163");
          zy.book.chapter_shenhe_ing = '0';
          zy.book.chapter_buy_status = '1';
        }
    }
</script>

<style lang="stylus" rel="stylesheet/stylus" scoped>
  /*@import '//at.alicdn.com/t/font_742546_4odf95dckcx.css'*/
  @import '../../../reader/reader_common.css'
  @import "../../../reader/read.css"
  .content
    width: 1000px
  .article .art_con, .article .art_con p
    font-size: 16px
  .article .art_con, .article .art_con p{font-size: 16px;}
</style>
